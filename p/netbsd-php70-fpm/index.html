
<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="UTF-8">
<meta name=keywords content="bbs, unix, free shell, shell account, free 
shell account, shell access, free account, netbsd, public access, unix 
system, dec alpha, arpa, vhost, free webhosting, free webhost, free irc 
sundays, SDF, Super Dimension Fortress, not lisp, genera, eggdrop, 
bouncer, 
learn unix, unix training, ethical social network, minecraft, paintchat, 
diaspora pod">
  <title>
    netbsd php70 fpm | 0/10 Don&#39;t Bookmark.
  </title>


  <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1">

  <link rel="canonical" href="https://aerth.github.io/blog/p/netbsd-php70-fpm/"/>

  <link rel="stylesheet" href="https://aerth.github.io/blog/css/sanitize.css">
  <link rel="stylesheet" href="https://aerth.github.io/blog/css/responsive.css">
  <link rel="stylesheet" href="https://aerth.github.io/blog/css/highlight_monokai.css">
  <link rel="stylesheet" href="https://aerth.github.io/blog/css/theme.css">
  <link rel="stylesheet" href="https://aerth.github.io/blog/css/custom.css">
  
  <link href="https://aerth.github.io/blog/index.xml" rel="alternate" type="application/rss+xml" title="0/10 Don&#39;t Bookmark." />
  <link href="https://aerth.github.io/blog/index.xml" rel="feed" type="application/rss+xml" title="0/10 Don&#39;t Bookmark." />

<script src="https://aerth.github.io/blog/js/jquery.js"></script>
<script src="https://aerth.github.io/blog/js/judy.js"></script>
<script src="https://aerth.github.io/blog/js/main.js"></script>

</head>



<body>
<div class="container">

  <header role="banner">
    <div class="row gutters">
      <div id="site-title" class="col span_6">
        <h1><a href="https://aerth.github.io/blog/">0/10 Don&#39;t Bookmark.</a></h1>
        <h2>unix and whatnot</h2>
      </div>
      <div id="social" class="col span_6">
        <ul>
          <li><a href="https://twitter.com/aerth___" target="_blank">Twitter</a></li>
          
          <li><a href="https://github.com/aerth" target="_blank">GitHub</a></li>
          <li><a href="https://gitlab.com/aerth" target="_blank">Git</a></li>
          
        </ul>
      </div>
    </div>
  </header>


  <main id="single" role="main">
    <div class="article-header">
      <h1>netbsd php70 fpm</h1>
      <div class="meta">
        Feb 12, 2016 &nbsp;
        
          #<a href="/tags/php-sucks">php sucks</a>&nbsp;
        
          #<a href="/tags/nginx">nginx</a>&nbsp;
        
          #<a href="/tags/netbsd">netbsd</a>&nbsp;
        
          #<a href="/tags/pkgsrc">pkgsrc</a>&nbsp;
        
      </div>
    </div>
    <article>
      

<h1 id="how-to-build-php-fpm-7-0-on-netbsd-from-pkgsrc">How to build php-fpm 7.0 on netbsd from pkgsrc</h1>

<h2 id="and-run-it-through-nginx-intertwined-with-another-app">And run it through nginx intertwined with another app.</h2>

<h1 id="cat-mk-conf">cat /mk.conf</h1>

<pre><code>PKG_OPTIONS.nginx+=     naxsi
PKG_RCD_SCRIPTS=YES
PHP_VERSIONS_ACCEPTED=70
</code></pre>

<h1 id="cat-usr-pkgsrc-meta-pkgs-php70-extensions-makefile">cat /usr/pkgsrc/meta-pkgs/php70-extensions/Makefile</h1>

<pre><code># Comment out these lines:

#DEPENDS+=      php&gt;=${PHP_VERSION}&lt;${NEXT_VERS}:${PHPPKGSRCDIR}
#DEPENDS+=      ${APACHE_PKG_PREFIX}-${PHP_PKG_PREFIX}&gt;=${PHP_VERSION}&lt;${NEXT_VERS}:../../www/ap-php
</code></pre>

<p>$ cd /usr/pkgsrc/meta-pkgs/php70-extensions/
$ make clean &amp;&amp; make update</p>

<p>$ cd /usr/pkgsrc/www/nginx
$ make clean &amp;&amp; make update</p>

<h1 id="cat-usr-pkg-etc-nginx-nginx-conf">cat /usr/pkg/etc/nginx/nginx.conf</h1>

<pre><code>
user   nginx  nginx;
worker_processes  1;
#error_log  /var/log/nginx/error.log;                                                                                      $
error_log  /var/log/nginx/error.log  debug;
#error_log  /var/log/nginx/error.log  info;
#pid        /var/run/nginx.pid;
events {
    worker_connections  1024;
}
http {
        server_tokens off;
        # server_names_hash_bucket_size 64;
        server_name_in_redirect off;
    include /usr/pkg/etc/nginx/naxsi_core.rules;
    include       /usr/pkg/etc/nginx/mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    #tcp_nopush     on;
    #keepalive_timeout  0;
    keepalive_timeout  65;
    #gzip  on;
        include /usr/pkg/etc/nginx/conf.d/*.conf;
        include /usr/pkg/etc/nginx/sites-enabled/*;
}


</code></pre>

<h1 id="cat-usr-pkg-etc-nginx-sites-enabled-default">cat /usr/pkg/etc/nginx/sites-enabled/_default</h1>

<h1 id="personally-i-dont-like-php-running-on-on-the-default-ip">Personally, I dont like php running on / on the default IP</h1>

<h1 id="use-this-to-route-to-a-specific-server-running-on-6099">Use this to route to a specific server running on 6099</h1>

<p>server {</p>

<pre><code>    server_name default_address;
    listen 80;
    location / {
    proxy_pass http://127.0.0.1:6099;
    }
</code></pre>

<p>}</p>

<h1 id="cat-usr-pkg-etc-nginx-sites-enabled-example-com">cat /usr/pkg/etc/nginx/sites-enabled/example.com</h1>

<pre><code>server {
        server_name isupon.us;
        error_page 404 /srv/live/_default/404.html;
        root   /srv/live/isupon.us/public;

# This shows our static page on :6099 for every request that isn't /
# This includes /index.php and /index.php?whatever
# Don't use those kind of URLs.

        location ~ $ {
        proxy_pass http://127.0.0.1:6099;
        }

        error_page 404             /404.html;
        error_page 500 502 503 504 /50x.html;

        location = / {
        fastcgi_pass 127.0.0.1:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root/index.php;
        fastcgi_param HTTPS off;
        include fastcgi_params;
        }

    # Generated thumbnail images
    location ~* /thumbs/(.*)$ {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Bolt backend access
    #
    # NOTE: If you set a custom branding path, you will need to change '/bolt/' 
    #       here to match
    location ~* /bolt/(.*)$ {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Backend async routes
    location ~* /async/(.*)$ {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Enforce caching for certain file extension types
    location ~* \.(?:ico|css|js|gif|jpe?g|png|ttf|woff|woff2)$ {
        access_log off;
        expires 30d;
        add_header Pragma public;
        add_header Cache-Control &quot;public, mustrevalidate, proxy-revalidate&quot;;
    }

    # Don't create logs for favicon.ico or robots.txt requests
    location = /(?:favicon.ico|robots.txt) {
        access_log off;
        log_not_found off;
    }

    # Block PHP files from being run in upload (files), app, theme and extension directories
    location ~* /(?:app|extensions|files|theme)/(.*)\.php$ {
        deny all;
    }

    # Block hidden files
    location ~ /\. {
        deny all;
    }

    # Block access to Sqlite database files
    location ~ /\.(?:db)$ {
        deny all;
    }

    # Block access to the app, cache &amp; vendor directories
    location ~ /(?:app|src|tests|vendor) {
        deny all;
    }

    # Block access to certain JSON files
    location ~ /(?:bower|composer|jsdoc|package)\.json$ {
        deny all;
    }

    # Block access to Markdown, Twig &amp; YAML files directly
    location ~* /(.*)\.(?:dist|markdown|md|twig|yaml|yml)$ {
        deny all;
    }




}

</code></pre>

<h1 id="now-requests-to-example-com-show-your-php-web-app">Now, requests to example.com show your php web app.</h1>

<h1 id="other-requests-go-to-your-other-app">Other requests go to your other app.</h1>

<p>durr</p>

      
    </article>

<div id="disqus_thread"></div>                                                                                                                                                                  
<script type="text/javascript">                                                                                                                                                                 
    var disqus_shortname = 'aerth';                                                                                                                                                             
    (function() {                                                                                                                                                                               
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;                                                                                             
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';                                                                                                                             
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);                                                                                
    })();                                                                                                                                                                                       
</script>                                                                                                                                                                                       
<noscript>no js = no comment. no problem!<br><br></noscript>

  </main>
  
  <nav class="pagination">
    
      <span class="previous">&lt; <a href="https://aerth.github.io/blog/p/gnusocial-command-line/" rel="prev">gnusocial command line</a></span>
    
    
      <span class="next"><a href="https://aerth.github.io/blog/p/golang-ports/" rel="next">golang ports</a> ></span>
    
  </nav>


  <footer role="contentinfo">
   <div style="text-align:center;">
    <img src="https://github.com/aerth.png"><br>
<a href="/">      </a>
    </div>
  </footer>


</div>

<script src="https://aerth.github.io/blog/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



</body>
</html>

